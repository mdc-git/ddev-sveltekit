name: ddev-sveltekit

pre_install_actions:
- |
  #ddev-nodisplay
  echo "Check for src/hooks.server.js:"
  if [ -f src/hooks.server.js ]; then
    echo "src/hooks.server.js exists. Cannot continue." && exit 2
  fi
  for file in \
    .ddev/nginx_full/nginx-site.conf \
    .ddev/sveltekit/hooks.server.js \
    .ddev/docker-compose.network.yaml; do
      if [ -f $file ]; then
        if ! grep "#ddev-generated" $file; then
          echo "remove old style file $file"
          rm $file
        fi
      fi
    done

project_files:
  - nginx_full/nginx-site.conf
  - sveltekit/hooks.server.js
  - docker-compose.network.yaml

post_install_actions:
  - cp sveltekit/hooks.server.js ../src/hooks.server.js
  - echo '##############################################################'
  - echo 'Please do not forget to edit .ddev/docker-compose.network.yaml'
  - echo '##############################################################'
